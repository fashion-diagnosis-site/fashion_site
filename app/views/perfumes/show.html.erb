<div class="intoro">
  <h5>診断結果</h5>
  <p>あなたに近いスタイル上位3つ</p>
</div>

<% top3 = @perfume.top3_styles %>

<div class="perfume-container">
  <ol>
    <% top3.each do |s| %>
      <li>
        <strong><%= s[:name] %></strong>
        （スコア：<%= s[:count] %>）
      </li>
    <% end %>
  </ol>

  <hr>

  <details>
    <summary>スコア内訳（1〜8）を開く</summary>
    <% counts = @perfume.style_counts %>
    <ul>
      <% counts.keys.sort.each do |sid| %>
        <li><%= Perfume::STYLE_NAMES[sid] %>：<%= counts[sid] %></li>
      <% end %>
    </ul>
  </details>

  <hr>

  <h6>参考コーデ</h6>

  <% top3.each do |s| %>
    <section class="style-section">
      <h5 class="style-title">#<%= s[:id] %> <%= s[:name] %></h5>
  
      <% cards = style_cards(s[:id]) %>
      <div class="style-grid">
        <% if cards.any? %>
          <% cards.each do |card| %>
            <div class="style-card">
              <% if card[:href].present? %>
                <%= link_to card[:href], target: "_blank", rel: "noopener noreferrer" do %>
                  <%= image_tag(card[:src], alt: "#{s[:name]} コーデ", loading: "lazy") %>
                <% end %>
              <% else %>
                <%= image_tag(card[:src], alt: "#{s[:name]} コーデ", loading: "lazy") %>
              <% end %>
            </div>
          <% end %>
        <% else %>
          <div class="style-card">
            <%= image_tag("placeholder.png", alt: "画像準備中", loading: "lazy") %>
          </div>
        <% end %>
      </div>
    </section>
  <% end %>
  
</div>

<style>
  .style-section { margin-bottom: 24px; }
  .style-title { margin: 8px 0 12px; font-weight: 700; }
  .style-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 12px;
  }
  .style-card {
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid #eee;
    background: #fff;
  }
  .style-card img {
    display: block;
    width: 100%;
    height: auto;
  }
</style>